{"version":3,"file":"PostCard.js","sources":["components/circle/PostCard.vue","../../../Software/hbuilder/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovMuWkp-iKsS_mr5XkuJrorr7orqEvQ29tcHVzL2NvbXBvbmVudHMvY2lyY2xlL1Bvc3RDYXJkLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"post-card mp-rounded\" @tap=\"$emit('view-detail', post)\">\r\n    <view class=\"post-header\">\r\n      <view class=\"user-info\">\r\n        <image :src=\"post.avatar\" class=\"post-avatar mp-rounded\"></image>\r\n        <view class=\"post-info\">\r\n          <text class=\"post-name\">{{post.name}}</text>\r\n          <text class=\"post-meta\">{{post.time}}</text>\r\n        </view>\r\n      </view>\r\n      <text class=\"post-tag\" :class=\"post.tagClass\">{{post.tag}}</text>\r\n    </view>\r\n    <text class=\"post-content\">{{post.content}}</text>\r\n    <view class=\"post-images\" v-if=\"post.images && post.images.length\">\r\n      <image \r\n        v-for=\"(img, idx) in post.images\" \r\n        :key=\"idx\" \r\n        :src=\"img\" \r\n        mode=\"aspectFill\" \r\n        class=\"post-image mp-rounded\"\r\n        @tap.stop=\"previewImage(post.images, idx)\"\r\n      ></image>\r\n    </view>\r\n    <view class=\"post-actions\">\r\n      <view class=\"action-item like-btn clickable-mp\" \r\n        :class=\"{ 'is-active': post.isLiked }\"\r\n        @tap.stop=\"likePost(post, idx)\" :disabled=\"post.likeLoading\">\r\n        <text class=\"action-icon iconfont icon-dianzan\"></text>\r\n        <text class=\"action-text\">{{post.likes}}</text>\r\n      </view>\r\n      <view class=\"action-item comment-btn clickable-mp\" @tap.stop=\"$emit('comment', post)\">\r\n        <text class=\"action-icon iconfont icon-icon_comment\"></text>\r\n        <text class=\"action-text\">{{post.comments}}</text>\r\n      </view>\r\n      <view class=\"action-item share-btn clickable-mp\" @tap.stop=\"$emit('share', post)\">\r\n        <text class=\"action-icon iconfont icon-fasong\"></text>\r\n        <text class=\"action-text\">分享</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'PostCard',\r\n  props: {\r\n    post: {\r\n      type: Object,\r\n      required: true\r\n    }\r\n  },\r\n  methods: {\r\n    previewImage(images, index) {\r\n      // 预览图片\r\n      uni.previewImage({\r\n        urls: images,\r\n        current: images[index]\r\n      });\r\n    },\r\n    // 点赞\r\n    likePost(post, index) {\r\n      if (post.likeLoading) return;\r\n      post.likeLoading = true;\r\n\r\n      const userId = uni.getStorageSync('uni-id-pages-userInfo')._id;\r\n      if (!userId) {\r\n        uni.showToast({ title: '请先登录', icon: 'none' });\r\n        post.likeLoading = false;\r\n        return;\r\n      }\r\n\r\n      // 本地先行\r\n      const originLiked = post.isLiked;\r\n      const originLikes = post.likes;\r\n\r\n      if (post.isLiked) {\r\n        // 先本地取消\r\n        post.isLiked = false;\r\n        post.likes -= 1;\r\n        // 查找点赞记录\r\n        uniCloud.database().collection('user-likes')\r\n          .where({\r\n            user_id: userId,\r\n            post_id: post._id\r\n          })\r\n          .get()\r\n          .then(res => {\r\n            if (res.result.data.length > 0) {\r\n              const likeId = res.result.data[0]._id;\r\n              uniCloud.database().collection('user-likes')\r\n                .doc(likeId)\r\n                .remove()\r\n                .then(() => {\r\n                  uniCloud.database().collection('add-content')\r\n                    .doc(post._id)\r\n                    .update({\r\n                      like_count: post.likes\r\n                    })\r\n                    .then(() => {\r\n                      uni.showToast({ title: '已取消点赞', icon: 'none' });\r\n                      post.likeLoading = false;\r\n                    })\r\n                    .catch(() => {\r\n                      // 回滚\r\n                      post.isLiked = originLiked;\r\n                      post.likes = originLikes;\r\n                      post.likeLoading = false;\r\n                    });\r\n                })\r\n                .catch(() => {\r\n                  post.isLiked = originLiked;\r\n                  post.likes = originLikes;\r\n                  post.likeLoading = false;\r\n                });\r\n            } else {\r\n              post.likeLoading = false;\r\n            }\r\n          })\r\n          .catch(() => {\r\n            post.isLiked = originLiked;\r\n            post.likes = originLikes;\r\n            post.likeLoading = false;\r\n          });\r\n      } else {\r\n        // 先本地加\r\n        post.isLiked = true;\r\n        post.likes += 1;\r\n        uniCloud.database().collection('user-likes')\r\n          .add({\r\n            user_id: userId,\r\n            post_id: post._id,\r\n            create_time: Date.now()\r\n          })\r\n          .then(() => {\r\n            uniCloud.database().collection('add-content')\r\n              .doc(post._id)\r\n              .update({\r\n                like_count: post.likes\r\n              })\r\n              .then(() => {\r\n                uni.showToast({ title: '已点赞', icon: 'none' });\r\n                post.likeLoading = false;\r\n              })\r\n              .catch(() => {\r\n                post.isLiked = originLiked;\r\n                post.likes = originLikes;\r\n                post.likeLoading = false;\r\n              });\r\n          })\r\n          .catch(() => {\r\n            post.isLiked = originLiked;\r\n            post.likes = originLikes;\r\n            post.likeLoading = false;\r\n          });\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n@import '@/styles/variables.scss';\r\n\r\n.post-card {\r\n  padding: 20rpx;\r\n  margin-bottom: 20rpx;\r\n  background-color: $white;\r\n  border-radius: $border-radius-base;\r\n  box-shadow: $shadow-sm;\r\n  transition: all $transition-base;\r\n  position: relative;\r\n  overflow: hidden;\r\n  // border: 1rpx solid rgba(0, 0, 0, 0.02);\r\n  \r\n  &:active {\r\n    transform: scale(0.98);\r\n    opacity: 0.95;\r\n  }\r\n}\r\n\r\n.post-header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 0 0 16rpx 0;\r\n  // margin-bottom: 16rpx;\r\n  // border-bottom: 1rpx solid rgba(0, 0, 0, 0.04);\r\n\r\n  .user-info {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 12rpx;\r\n  }\r\n  \r\n  .post-avatar {\r\n    width: 76rpx;\r\n    height: 76rpx;\r\n    border-radius: $border-radius-circle;\r\n    background-color: $bg-color;\r\n    // border: 2rpx solid $extra-light-gray;\r\n    box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.08);\r\n  }\r\n  \r\n  .post-info {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 4rpx;\r\n    \r\n    .post-name {\r\n      font-size: 30rpx;\r\n      font-weight: 600;\r\n      color: $dark-gray;\r\n      line-height: 1.3;\r\n    }\r\n    \r\n    .post-meta {\r\n      font-size: 22rpx;\r\n      color: $gray;\r\n      line-height: 1.2;\r\n    }\r\n  }\r\n\r\n  .post-tag {\r\n    padding: 4rpx 16rpx;\r\n    border-radius: $border-radius-lg;\r\n    font-size: 22rpx;\r\n    font-weight: 500;\r\n    \r\n    &.discussion {\r\n      background: rgba($primary-color, 0.1);\r\n      color: $primary-color;\r\n    }\r\n    \r\n    &.question {\r\n      background: rgba($warning-color, 0.1);\r\n      color: $warning-color;\r\n    }\r\n    \r\n    &.lost {\r\n      background: rgba($error-color, 0.1);\r\n      color: $error-color;\r\n    }\r\n    \r\n    &.pin {\r\n      background: rgba($success-color, 0.1);\r\n      color: $success-color;\r\n    }\r\n    \r\n    &.official {\r\n      background: rgba($info-color, 0.1);\r\n      color: $info-color;\r\n    }\r\n    \r\n    &.promotion {\r\n      background: rgba($purple-color, 0.1);\r\n      color: $purple-color;\r\n    }\r\n  }\r\n}\r\n\r\n.post-content {\r\n  font-size: $font-size-base;\r\n  color: $dark-gray;\r\n  margin-bottom: 16rpx;\r\n  line-height: $line-height-normal;\r\n  padding-left: 10rpx;\r\n}\r\n\r\n.post-images {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  margin: 0 -6rpx 16rpx;\r\n  padding-left: 10rpx;\r\n  \r\n  .post-image {\r\n    width: calc(33.33% - 12rpx);\r\n    height: 200rpx;\r\n    margin: 6rpx;\r\n    border-radius: $border-radius-sm;\r\n    background-color: $bg-color;\r\n    transition: all $transition-fast;\r\n    \r\n    &:active {\r\n      transform: scale(0.95);\r\n    }\r\n  }\r\n}\r\n\r\n.post-actions {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-around;\r\n  border-top: 1rpx solid rgba(0, 0, 0, 0.03);\r\n  padding-top: 16rpx;\r\n  margin-top: 10rpx;\r\n  \r\n  .action-item {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding: 8rpx 20rpx;\r\n    border-radius: $border-radius-lg;\r\n    transition: all $transition-fast;\r\n    \r\n    .action-icon {\r\n      font-size: $font-size-lg;\r\n      color: $gray;\r\n      margin-right: 10rpx;\r\n      transition: all $transition-fast;\r\n    }\r\n    \r\n    .action-text {\r\n      font-size: $font-size-sm;\r\n      color: $gray;\r\n      transition: all $transition-fast;\r\n    }\r\n    \r\n    &:active {\r\n      background-color: rgba(0, 0, 0, 0.03);\r\n      transform: scale(0.95);\r\n    }\r\n    \r\n    &.is-active {\r\n      .action-icon {\r\n        color: $error-color;\r\n        animation: heartBeat 0.3s ease-in-out;\r\n      }\r\n      \r\n      .action-text {\r\n        color: $error-color;\r\n      }\r\n    }\r\n  }\r\n  \r\n  .like-btn {\r\n    &:active .action-icon {\r\n      color: $error-color;\r\n      transform: scale(1.2);\r\n    }\r\n  }\r\n  \r\n  .comment-btn {\r\n    &:active .action-icon {\r\n      color: $primary-color;\r\n      transform: scale(1.2);\r\n    }\r\n  }\r\n  \r\n  .share-btn {\r\n    &:active .action-icon {\r\n      color: $success-color;\r\n      transform: scale(1.2);\r\n    }\r\n  }\r\n}\r\n\r\n@keyframes heartBeat {\r\n  0% {\r\n    transform: scale(1);\r\n  }\r\n  50% {\r\n    transform: scale(1.3);\r\n  }\r\n  100% {\r\n    transform: scale(1);\r\n  }\r\n}\r\n</style>","import Component from 'D:/2大花/毕业设计/Compus/components/circle/PostCard.vue'\nwx.createComponent(Component)"],"names":["uni","uniCloud"],"mappings":";;AA2CA,MAAK,YAAU;AAAA,EACb,MAAM;AAAA,EACN,OAAO;AAAA,IACL,MAAM;AAAA,MACJ,MAAM;AAAA,MACN,UAAU;AAAA,IACZ;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACP,aAAa,QAAQ,OAAO;AAE1BA,oBAAAA,MAAI,aAAa;AAAA,QACf,MAAM;AAAA,QACN,SAAS,OAAO,KAAK;AAAA,MACvB,CAAC;AAAA,IACF;AAAA;AAAA,IAED,SAAS,MAAM,OAAO;AACpB,UAAI,KAAK;AAAa;AACtB,WAAK,cAAc;AAEnB,YAAM,SAASA,cAAG,MAAC,eAAe,uBAAuB,EAAE;AAC3D,UAAI,CAAC,QAAQ;AACXA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAC7C,aAAK,cAAc;AACnB;AAAA,MACF;AAGA,YAAM,cAAc,KAAK;AACzB,YAAM,cAAc,KAAK;AAEzB,UAAI,KAAK,SAAS;AAEhB,aAAK,UAAU;AACf,aAAK,SAAS;AAEdC,sBAAAA,GAAS,SAAQ,EAAG,WAAW,YAAY,EACxC,MAAM;AAAA,UACL,SAAS;AAAA,UACT,SAAS,KAAK;AAAA,SACf,EACA,IAAI,EACJ,KAAK,SAAO;AACX,cAAI,IAAI,OAAO,KAAK,SAAS,GAAG;AAC9B,kBAAM,SAAS,IAAI,OAAO,KAAK,CAAC,EAAE;AAClCA,0BAAAA,GAAS,SAAQ,EAAG,WAAW,YAAY,EACxC,IAAI,MAAM,EACV,OAAO,EACP,KAAK,MAAM;AACVA,4BAAAA,GAAS,SAAQ,EAAG,WAAW,aAAa,EACzC,IAAI,KAAK,GAAG,EACZ,OAAO;AAAA,gBACN,YAAY,KAAK;AAAA,eAClB,EACA,KAAK,MAAM;AACVD,8BAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,OAAK,CAAG;AAC9C,qBAAK,cAAc;AAAA,eACpB,EACA,MAAM,MAAM;AAEX,qBAAK,UAAU;AACf,qBAAK,QAAQ;AACb,qBAAK,cAAc;AAAA,cACrB,CAAC;AAAA,aACJ,EACA,MAAM,MAAM;AACX,mBAAK,UAAU;AACf,mBAAK,QAAQ;AACb,mBAAK,cAAc;AAAA,YACrB,CAAC;AAAA,iBACE;AACL,iBAAK,cAAc;AAAA,UACrB;AAAA,SACD,EACA,MAAM,MAAM;AACX,eAAK,UAAU;AACf,eAAK,QAAQ;AACb,eAAK,cAAc;AAAA,QACrB,CAAC;AAAA,aACE;AAEL,aAAK,UAAU;AACf,aAAK,SAAS;AACdC,sBAAAA,GAAS,SAAQ,EAAG,WAAW,YAAY,EACxC,IAAI;AAAA,UACH,SAAS;AAAA,UACT,SAAS,KAAK;AAAA,UACd,aAAa,KAAK,IAAI;AAAA,SACvB,EACA,KAAK,MAAM;AACVA,wBAAAA,GAAS,SAAQ,EAAG,WAAW,aAAa,EACzC,IAAI,KAAK,GAAG,EACZ,OAAO;AAAA,YACN,YAAY,KAAK;AAAA,WAClB,EACA,KAAK,MAAM;AACVD,0BAAG,MAAC,UAAU,EAAE,OAAO,OAAO,MAAM,OAAK,CAAG;AAC5C,iBAAK,cAAc;AAAA,WACpB,EACA,MAAM,MAAM;AACX,iBAAK,UAAU;AACf,iBAAK,QAAQ;AACb,iBAAK,cAAc;AAAA,UACrB,CAAC;AAAA,SACJ,EACA,MAAM,MAAM;AACX,eAAK,UAAU;AACf,eAAK,QAAQ;AACb,eAAK,cAAc;AAAA,QACrB,CAAC;AAAA,MACL;AAAA,IACF;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5JA,GAAG,gBAAgB,SAAS;"}