{"version":3,"file":"circle.js","sources":["pages/circle/circle.vue","../../../Software/hbuilder/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2lyY2xlL2NpcmNsZS52dWU"],"sourcesContent":["<template>\n\t<view class=\"circle-container\">\n\t\t<!-- 搜索框 -->\n\t\t<view class=\"search-bar\">\n\t\t\t<view class=\"search-input-wrapper\">\n\t\t\t\t<text class=\"iconfont icon-icon_search search-icon\"></text>\n\t\t\t\t<input class=\"search-input\" placeholder=\"请输入搜索内容\" />\n\t\t\t</view>\n\t\t</view>\n\t\t<!-- 顶部大图+分类叠加 -->\n\t\t<view class=\"banner-wrapper\">\n\t\t\t<image class=\"banner-image\" src=\"/static/images/circlebanner.png\" mode=\"aspectFill\"></image>\n\t\t\t<view class=\"banner-bottom-gradient\"></view>\n\t\t\t<view class=\"category-nav-abs\">\n\t\t\t\t<scroll-view scroll-x=\"true\" show-scrollbar=\"false\" class=\"category-scroll\">\n\t\t\t\t\t<view class=\"category-list\">\n\t\t\t\t\t\t<view \n\t\t\t\t\t\t\tv-for=\"(item, index) in categories\" \n\t\t\t\t\t\t\t:key=\"index\" \n\t\t\t\t\t\t\t:id=\"'category-' + index\"\n\t\t\t\t\t\t\tclass=\"category-container\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<category-item\n\t\t\t\t\t\t\t\t:name=\"item.name\"\n\t\t\t\t\t\t\t\t:icon-img=\"item.iconImg\"\n\t\t\t\t\t\t\t\t:is-active=\"activeCategory === index\"\n\t\t\t\t\t\t\t\t@switch=\"switchCategory(index)\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</scroll-view>\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"main-content\">\n\t\t\t<!-- 专题活动 -->\n\t\t\t<view class=\"section bg-white mt-base p-base rounded\">\n\t\t\t\t<view class=\"section-header flex-between mb-sm\">\n\t\t\t\t\t<view class=\"section-title flex items-center font-bold text-lg\">\n\t\t\t\t\t\t<view class=\"icon-wrapper bg-gradient-warning\">\n\t\t\t\t\t\t\t<text class=\"iconfont icon-huodong text-white\"></text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<text class=\"text-dark\">专题活动</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"more text-primary text-sm flex items-center\" @tap=\"viewAllActivities\">\n\t\t\t\t\t\t<text>查看全部</text>\n\t\t\t\t\t\t<text class=\"iconfont icon-gengduo ml-xs\"></text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<scroll-view class=\"activity-scroll\" scroll-x=\"true\" show-scrollbar=\"false\">\n\t\t\t\t\t<view class=\"activity-list\">\n\t\t\t\t\t\t<ActivityCard\n\t\t\t\t\t\t\tv-for=\"(item, index) in activities\" \n\t\t\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t\t\t:activity=\"item\"\n\t\t\t\t\t\t\t@view-detail=\"viewActivityDetail\"\n\t\t\t\t\t\t\t@join=\"joinActivity\"\n\t\t\t\t\t\t></ActivityCard>\n\t\t\t\t\t</view>\n\t\t\t\t</scroll-view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- 置顶与推广内容 -->\n\t\t\t<view class=\"pinned-section bg-white mt-base p-base rounded\">\n\t\t\t\t<view class=\"section-header flex-between mb-sm pinned-header\">\n\t\t\t\t\t<view class=\"section-title flex items-center font-bold text-lg\">\n\t\t\t\t\t\t<view class=\"icon-wrapper pinned-gradient\">\n\t\t\t\t\t\t\t<text class=\"iconfont icon-zhiding text-white\"></text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<text class=\"pinned-title\">置顶与推广</text>\n\t\t\t\t\t\t<view class=\"pinned-badge ml-xs\">2</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<!-- 置顶内容1 -->\n\t\t\t\t<pinned-card \n\t\t\t\t\t:post=\"pinnedPosts[0]\" \n\t\t\t\t\t@view-detail=\"viewPinnedDetail\"\n\t\t\t\t></pinned-card>\n\t\t\t\t\n\t\t\t\t<!-- 置顶内容2 -->\n\t\t\t\t<pinned-card \n\t\t\t\t\t:post=\"pinnedPosts[1]\" \n\t\t\t\t\t@view-detail=\"viewPinnedDetail\"\n\t\t\t\t></pinned-card>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- 动态列表 -->\n\t\t\t<view class=\"post-section bg-white mt-base p-base rounded\">\n\t\t\t\t<view class=\"section-header flex-between mb-sm\">\n\t\t\t\t\t<view class=\"section-title flex items-center font-bold text-lg\">\n\t\t\t\t\t\t<view class=\"icon-wrapper bg-gradient-primary\">\n\t\t\t\t\t\t\t<text class=\"iconfont icon-wenda text-white\"></text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<text class=\"text-dark\">最新动态</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"filter-tabs\">\n\t\t\t\t\t\t<text \n\t\t\t\t\t\t\tv-for=\"(tab, index) in filterTabs\" \n\t\t\t\t\t\t\t:key=\"index\" \n\t\t\t\t\t\t\tclass=\"filter-tab\" \n\t\t\t\t\t\t\t:class=\"{ active: activeTab === index }\"\n\t\t\t\t\t\t\t@tap=\"switchTab(index)\"\n\t\t\t\t\t\t>{{ tab }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<!-- 空状态显示 -->\n\t\t\t\t<view class=\"empty-state\" v-if=\"posts.length === 0 && !loading\">\n\t\t\t\t\t<text class=\"iconfont icon-empty empty-icon\"></text>\n\t\t\t\t\t<view class=\"empty-text\">暂无内容</view>\n\t\t\t\t\t<button class=\"btn btn-outline mt-base clickable-mp\" @tap=\"onRefresh\">\n\t\t\t\t\t\t<text class=\"iconfont icon-shijian mr-xs\"></text>刷新试试\n\t\t\t\t\t</button>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<view class=\"post-list\" v-else>\n\t\t\t\t\t<post-card \n\t\t\t\t\t\tv-for=\"(post, index) in posts\" \n\t\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t\t:post=\"post\"\n\t\t\t\t\t\t@view-detail=\"viewPostDetail\"\n\t\t\t\t\t\t@like=\"likePost($event, index)\"\n\t\t\t\t\t\t@comment=\"commentPost\"\n\t\t\t\t\t\t@share=\"sharePost\"\n\t\t\t\t\t></post-card>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<!-- 加载状态 -->\n\t\t\t\t<view class=\"loading\" v-if=\"loading\">\n\t\t\t\t\t<text class=\"iconfont icon-loading loading-icon\"></text>\n\t\t\t\t\t<text class=\"text-sm text-gray\">加载中...</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"empty-state\" v-if=\"noMore && posts.length > 0\">\n\t\t\t\t\t<text class=\"text-sm text-gray\">没有更多内容了</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 悬浮操作按钮 -->\n\t\t<view>\n\t\t\t<!-- 遮罩层 -->\n\t\t\t<view v-if=\"showFabMenu\" class=\"fab-mask\" @tap=\"closeFabMenu\"></view>\n\t\t\t<!-- 弹出菜单 -->\n\t\t\t<view v-if=\"showFabMenu\" class=\"fab-menu\">\n\t\t\t\t<view class=\"fab-menu-item\" @tap=\"publishPost\" >\n\t\t\t\t\t<text class=\"iconfont icon-bianji\"></text>\n\t\t\t\t\t<text class=\"fab-menu-text\">发帖子</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"fab-menu-item\" @tap=\"publishActivity\">\n\t\t\t\t\t<text class=\"iconfont icon-huodong\"></text>\n\t\t\t\t\t<text class=\"fab-menu-text\">发活动</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<!-- 主悬浮按钮 -->\n\t\t\t<view class=\"float-btn flex-center\" @tap=\"toggleFabMenu\">\n\t\t\t\t<text class=\"iconfont\" \n\t\t\t\t:class=\"showFabMenu ? 'icon-jianshao' : 'icon-a-chuangjiantianjiapiliangtianjia'\"></text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\nimport ActivityCard from '@/components/circle/ActivityCard.vue';\nimport PostCard from '@/components/circle/PostCard.vue';\nimport PinnedCard from '@/components/circle/PinnedCard.vue';\nimport CategoryItem from '@/components/circle/CategoryItem.vue';\n\nexport default {\n\tcomponents: {\n\t\tActivityCard,\n\t\tPostCard,\n\t\tPinnedCard,\n\t\tCategoryItem\n\t},\n\tdata() {\n\t\treturn {\n\t\t\trefreshing: false,\n\t\t\tloading: false,\n\t\t\tnoMore: false,\n\t\t\tpage: 1,\n\t\t\tactiveCategory: 0,\n\t\t\tactiveTab: 0,\n\t\t\tcategories: [\n\t\t\t\t{ name: '推荐', iconImg: '/static/images/cat1.jpg' },\n\t\t\t\t{ name: '热门活动', iconImg: '/static/images/cat2.jpg' },\n\t\t\t\t{ name: '校园问答', iconImg: '/static/images/cat3.jpg' },\n\t\t\t\t{ name: '校园吐槽', iconImg: '/static/images/cat4.jpg' },\n\t\t\t\t{ name: '以物换物', iconImg: '/static/images/cat5.jpg' }\n\t\t\t],\n\t\t\tfilterTabs: ['最新', '热门', '关注'],\n\t\t\tactivities: [],\n\t\t\tpinnedPosts: [\n\t\t\t\t{\n\t\t\t\t\tid: 1,\n\t\t\t\t\tavatar: 'https://picsum.photos/id/1/48/48',\n\t\t\t\t\tname: '校园公告',\n\t\t\t\t\ttype: '官方',\n\t\t\t\t\ttime: '2小时前',\n\t\t\t\t\tcontent: '各位同学请注意，学校将于5月25日至5月27日进行教学楼维修改造工程，期间相关教室将暂停使用，请大家合理安排学习时间。',\n\t\t\t\t\tlikes: 128,\n\t\t\t\t\tcomments: 36\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 2,\n\t\t\t\t\tavatar: 'https://picsum.photos/id/2/48/48',\n\t\t\t\t\tname: '校园超市',\n\t\t\t\t\ttype: '商家',\n\t\t\t\t\ttime: '昨天',\n\t\t\t\t\tcontent: '校园超市将于本周进行夏季大促销活动，各类饮料、零食、生活用品均有优惠，欢迎同学们前来选购！',\n\t\t\t\t\timages: [\n\t\t\t\t\t\t'https://picsum.photos/id/20/200/200',\n\t\t\t\t\t\t'https://picsum.photos/id/21/200/200',\n\t\t\t\t\t\t'https://picsum.photos/id/22/200/200'\n\t\t\t\t\t],\n\t\t\t\t\tlikes: 86,\n\t\t\t\t\tcomments: 24\n\t\t\t\t}\n\t\t\t],\n\t\t\tposts: [],\n\t\t\tshowFabMenu: false\n\t\t};\n\t},\n\tasync onLoad() {\n\t\t// 页面加载时初始化数据\n\t\tthis.initData();\n\t\tthis.fetchPostsFromCloud();\n\t\tuni.setStorageSync('posts', this.posts);\n\t\tawait this.fetchActivitiesFromCloud();\n\t},\n\tonShow() {\n\t\tthis.fetchPostsFromCloud();\n\t},\n\tmethods: {\n\t\t// 初始化数据\n\t\tinitData() {\n\t\t\t// 模拟网络请求获取数据\n\t\t\tthis.fetchData();\n\t\t},\n\t\t\n\t\t// 获取数据\n\t\tfetchData(isLoadMore = false) {\n\t\t\t// 实际项目中这里应该是网络请求\n\t\t\tif (isLoadMore) {\n\t\t\t\tthis.loading = true;\n\t\t\t}\n\t\t\t\n\t\t\t// 模拟网络请求延迟\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (!isLoadMore) {\n\t\t\t\t\t// 刷新数据\n\t\t\t\t\t// 实际项目中应该用返回数据替换\n\t\t\t\t} else {\n\t\t\t\t\t// 加载更多\n\t\t\t\t\tif (this.page > 3) {\n\t\t\t\t\t\tthis.noMore = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// 模拟添加更多数据\n\t\t\t\t\t\tthis.posts.push({\n\t\t\t\t\t\t\tid: this.posts.length + 1,\n\t\t\t\t\t\t\tavatar: '/static/images/avatar3.png',\n\t\t\t\t\t\t\tname: '王大力',\n\t\t\t\t\t\t\tcollege: '机械工程学院',\n\t\t\t\t\t\t\ttime: '5小时前',\n\t\t\t\t\t\t\ttag: '问答',\n\t\t\t\t\t\t\ttagClass: 'question',\n\t\t\t\t\t\t\tcontent: '有人知道学校食堂什么时候开始供应冷饮吗？天气越来越热了。',\n\t\t\t\t\t\t\tlikes: 18,\n\t\t\t\t\t\t\tcomments: 7,\n\t\t\t\t\t\t\tisLiked: false\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 重置加载状态\n\t\t\t\tthis.refreshing = false;\n\t\t\t\tthis.loading = false;\n\t\t\t}, 1000);\n\t\t},\n\t\t\n\t\t// 下拉刷新\n\t\tonRefresh() {\n\t\t\tif (this.refreshing) return;\n\t\t\t\n\t\t\tthis.refreshing = true;\n\t\t\tthis.page = 1;\n\t\t\tthis.noMore = false;\n\t\t\tthis.fetchData();\n\t\t},\n\t\t\n\t\t// 上拉加载更多\n\t\tonLoadMore() {\n\t\t\tif (this.loading || this.noMore) return;\n\t\t\t\n\t\t\tthis.page++;\n\t\t\tthis.fetchData(true);\n\t\t},\n\t\t\n\t\t// 切换分类\n\t\tswitchCategory(index) {\n\t\t\tif (this.activeCategory === index) return;\n\t\t\t\n\t\t\tthis.activeCategory = index;\n\t\t\t// 切换分类后刷新数据\n\t\t\tthis.onRefresh();\n\t\t},\n\t\t\n\t\t// 切换标签\n\t\tswitchTab(index) {\n\t\t\tif (this.activeTab === index) return;\n\t\t\t\n\t\t\tthis.activeTab = index;\n\t\t\t// 切换标签后刷新数据\n\t\t\tthis.onRefresh();\n\t\t},\n\t\t\n\t\t// 查看活动详情\n\t\tviewActivityDetail(activity) {\n\t\t\tconsole.log('查看活动详情', activity);\n\t\t\tuni.navigateTo({\n\t\t\t\turl: `/pages/circle/activity-datail/activity-datail?id=${activity._id}`\n\t\t\t});\n\t\t},\n\t\t\n\t\t// 参与活动（关键修改）\n\t\tasync joinActivity(item) {\n\t\t\tconsole.log('参与活动', item);\n\t\t\ttry {\n\t\t\t\t// 检查登录状态\n\t\t\t\tconst token = uni.getStorageSync('uni_id_token');\n\t\t\t\tif (!token) {\n\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\ttitle: '提示',\n\t\t\t\t\t\tcontent: '请先登录后再参与活动',\n\t\t\t\t\t\tconfirmText: '去登录',\n\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\t\t\t\turl: '/pages/login/login'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\n\t\t\t\t// 调用云函数\n\t\t\t\tconst res = await uniCloud.callFunction({\n\t\t\t\t\tname: 'joinactivity',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tactivityId: item._id,\n\t\t\t\t\t\ttoken: token\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\n\t\t\t\tif (res.result.success) {\n\t\t\t\t\tuni.showToast({ title: '参与成功', icon: 'success' });\n\t\t\t\t\t// 直接调用获取活动数据的方法\n\t\t\t\t\tawait this.fetchActivitiesFromCloud();\n\t\t\t\t\t// 同时刷新帖子列表\n\t\t\t\t\tawait this.fetchPostsFromCloud();\n\t\t\t\t} else {\n\t\t\t\t\t// 处理特定的错误码\n\t\t\t\t\tif (res.result.code === 'TOKEN_INVALID') {\n\t\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\t\ttitle: '提示',\n\t\t\t\t\t\t\tcontent: '登录状态已失效，请重新登录',\n\t\t\t\t\t\t\tconfirmText: '去登录',\n\t\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\t\t\t\t\turl: '/pages/login/login'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tuni.showToast({ \n\t\t\t\t\t\t\ttitle: res.result.message || '参与失败', \n\t\t\t\t\t\t\ticon: 'none' \n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('参与活动失败', err);\n\t\t\t\tuni.showToast({ title: '参与失败，请稍后重试', icon: 'none' });\n\t\t\t}\n\t\t},\n\t\t\n\t\t// 查看置顶帖子详情\n\t\tviewPinnedDetail(post) {\n\t\t\tuni.navigateTo({\n\t\t\t\turl: `/pages/circle/pinned-datail/pinned-datail?id=${post.id}`\n\t\t\t});\n\t\t},\n\t\t\n\t\t// 查看帖子详情\n\t\tviewPostDetail(post) {\n\t\t\tuni.navigateTo({\n\t\t\t\turl: `/pages/circle/post-datail/post-datail?id=${post._id}`\n\t\t\t});\n\t\t},\n\t\t\n\t\t// 点赞帖子\n\t\tlikePost(post, index) {\n\t\t\t// 防止重复点击\n\t\t\tif (post.likeLoading) return;\n\t\t\tpost.likeLoading = true;\n\n\t\t\t// 检查 _id\n\t\t\tif (!post._id || typeof post._id !== 'string') {\n\t\t\t\tuni.showToast({ title: '帖子ID异常', icon: 'none' });\n\t\t\t\tpost.likeLoading = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (typeof post.likes !== 'number') post.likes = 0;\n\n\t\t\t// 获取当前用户ID\n\t\t\tconst userId = uni.getStorageSync('uni-id-pages-userInfo')._id;\n\t\t\tif (!userId) {\n\t\t\t\tuni.showToast({ title: '请先登录', icon: 'none' });\n\t\t\t\tpost.likeLoading = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 检查用户是否已点赞\n\t\t\tuniCloud.database().collection('user-likes')\n\t\t\t\t.where({\n\t\t\t\t\tuser_id: userId,\n\t\t\t\t\tpost_id: post._id\n\t\t\t\t})\n\t\t\t\t.get()\n\t\t\t\t.then(res => {\n\t\t\t\t\tif (res.result.data.length > 0) {\n\t\t\t\t\t\t// 已点赞，执行取消点赞\n\t\t\t\t\t\tconst likeId = res.result.data[0]._id;\n\t\t\t\t\t\tuniCloud.database().collection('user-likes')\n\t\t\t\t\t\t\t.doc(likeId)\n\t\t\t\t\t\t\t.remove()\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tuniCloud.database().collection('add-content')\n\t\t\t\t\t\t\t\t\t.doc(post._id)\n\t\t\t\t\t\t\t\t\t.update({\n\t\t\t\t\t\t\t\t\t\tlike_count: post.likes - 1\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\t\tpost.isLiked = false;\n\t\t\t\t\t\t\t\t\t\tpost.likes -= 1;\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\t\t\ttitle: '已取消点赞',\n\t\t\t\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tpost.likeLoading = false;\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.catch(() => { post.likeLoading = false; });\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(() => { post.likeLoading = false; });\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// 未点赞，执行点赞\n\t\t\t\t\t\tuniCloud.database().collection('user-likes')\n\t\t\t\t\t\t\t.add({\n\t\t\t\t\t\t\t\tuser_id: userId,\n\t\t\t\t\t\t\t\tpost_id: post._id,\n\t\t\t\t\t\t\t\tcreate_time: Date.now()\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tuniCloud.database().collection('add-content')\n\t\t\t\t\t\t\t\t\t.doc(post._id)\n\t\t\t\t\t\t\t\t\t.update({\n\t\t\t\t\t\t\t\t\t\tlike_count: post.likes + 1\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\t\tpost.isLiked = true;\n\t\t\t\t\t\t\t\t\t\tpost.likes += 1;\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\t\t\ttitle: '已点赞',\n\t\t\t\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tpost.likeLoading = false;\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.catch(() => { post.likeLoading = false; });\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(() => { post.likeLoading = false; });\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tuni.showToast({ title: '操作失败', icon: 'none' });\n\t\t\t\t\tconsole.error('点赞操作失败', err);\n\t\t\t\t\tpost.likeLoading = false;\n\t\t\t\t});\n\t\t},\n\t\t\n\t\t// 评论帖子\n\t\tcommentPost(post) {\n\t\t\tconsole.log('评论帖子', post);\n\t\t\t// 实际项目中应弹出评论输入框或跳转到评论页面\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '评论功能开发中',\n\t\t\t\ticon: 'none'\n\t\t\t});\n\t\t},\n\t\t\n\t\t// 分享帖子\n\t\tsharePost(post) {\n\t\t\tconsole.log('分享帖子', post);\n\t\t\t// 实际项目中应调用分享API\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '分享功能开发中',\n\t\t\t\ticon: 'none'\n\t\t\t});\n\t\t},\n\t\t\n\t\t// 发布新帖子\n\t\tpublishPost() {\n\t\t\tthis.showFabMenu = false;\n\t\t\t// 跳转到发帖页面\n\t\t\tuni.navigateTo({\n\t\t\t\turl: '/pages/circle/post-create/post-create'\n\t\t\t});\n\t\t},\n\t\n\t\t\n\t\t// 查看全部活动\n\t\tviewAllActivities() {\n\t\t\tconsole.log('查看全部活动');\n\t\t\tuni.navigateTo({\n\t\t\t\turl: '/pages/circle/activities/activities'\n\t\t\t});\n\t\t},\n\t\t\n\t\ttoggleFabMenu() {\n\t\t\tthis.showFabMenu = !this.showFabMenu;\n\t\t},\n\t\tcloseFabMenu() {\n\t\t\tthis.showFabMenu = false;\n\t\t},\n\t\tpublishActivity() {\n\t\t\tthis.showFabMenu = false;\n\t\t\t// 跳转到发活动页面\n\t\t\tuni.showToast({ title: '发活动功能开发中', icon: 'none' });\n\t\t\tuni.navigateTo({\n\t\t\t\turl: '/pages/circle/addactivities/addactivities'\n\t\t\t});\n\t\t},\n\t\t// 获取帖子数据\n\t\tfetchPostsFromCloud() {\n\t\t\tthis.loading = true;\n\t\t\t// 获取当前用户ID\n\t\t\tconst userId = uni.getStorageSync('uni-id-pages-userInfo')._id;\n\n\t\t\tuniCloud.database().collection('add-content')\n\t\t\t\t.where({\n\t\t\t\t\tcontent_type: 'post',\n\t\t\t\t\tstatus: 'published'\n\t\t\t\t})\n\t\t\t\t.orderBy('create_time', 'desc')\n\t\t\t\t.get()\n\t\t\t\t.then(res => {\n\t\t\t\t\tconst posts = res.result.data;\n\t\t\t\t\t// 收集所有 user_id\n\t\t\t\t\tconst userIds = [...new Set(posts.map(item => item.user_id).filter(Boolean))];\n\t\t\t\t\tif (userIds.length === 0) {\n\t\t\t\t\t\tthis.posts = [];\n\t\t\t\t\t\tthis.loading = false;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// 获取用户点赞状态\n\t\t\t\t\tconst getLikesPromise = userId ? \n\t\t\t\t\t\tuniCloud.database().collection('user-likes')\n\t\t\t\t\t\t\t.where({\n\t\t\t\t\t\t\t\tuser_id: userId,\n\t\t\t\t\t\t\t\tpost_id: uniCloud.database().command.in(posts.map(p => p._id))\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.get()\n\t\t\t\t\t\t\t.then(likesRes => {\n\t\t\t\t\t\t\t\tconst likedPostIds = new Set(likesRes.result.data.map(like => like.post_id));\n\t\t\t\t\t\t\t\treturn likedPostIds;\n\t\t\t\t\t\t\t}) : \n\t\t\t\t\t\tPromise.resolve(new Set());\n\n\t\t\t\t\t// 批量查用户表\n\t\t\t\t\tconst getUserInfoPromise = uniCloud.database().collection('uni-id-users')\n\t\t\t\t\t\t.where({\n\t\t\t\t\t\t\t_id: uniCloud.database().command.in(userIds)\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.field('_id,avatar_file,nickname')\n\t\t\t\t\t\t.get()\n\t\t\t\t\t\t.then(userRes => {\n\t\t\t\t\t\t\tconst userMap = {};\n\t\t\t\t\t\t\tuserRes.result.data.forEach(u => {\n\t\t\t\t\t\t\t\tuserMap[u._id] = u;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn userMap;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t// 等待所有数据获取完成\n\t\t\t\t\tPromise.all([getLikesPromise, getUserInfoPromise])\n\t\t\t\t\t\t.then(([likedPostIds, userMap]) => {\n\t\t\t\t\t\t\t// 组装帖子数据\n\t\t\t\t\t\t\tthis.posts = posts.map(item => {\n\t\t\t\t\t\t\t\tconst user = userMap[item.user_id] || {};\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t_id: item._id,\n\t\t\t\t\t\t\t\t\tavatar: user.avatar_file && user.avatar_file.url ? user.avatar_file.url : '/static/images/default-avatar.png',\n\t\t\t\t\t\t\t\t\tname: user.nickname || '匿名用户',\n\t\t\t\t\t\t\t\t\ttime: this.formatTime(item.create_time),\n\t\t\t\t\t\t\t\t\ttag: item.category,\n\t\t\t\t\t\t\t\t\ttagClass: this.getTagClass(item.category),\n\t\t\t\t\t\t\t\t\tcontent: item.content,\n\t\t\t\t\t\t\t\t\timages: item.files || [],\n\t\t\t\t\t\t\t\t\tlikes: item.like_count || 0,\n\t\t\t\t\t\t\t\t\tcomments: item.comment_count || 0,\n\t\t\t\t\t\t\t\t\tisLiked: likedPostIds.has(item._id)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.loading = false;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\tconsole.error('帖子加载失败', err);\n\t\t\t\t\t\t\tthis.loading = false;\n\t\t\t\t\t\t\tuni.showToast({ title: '数据加载失败', icon: 'none' });\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tthis.loading = false;\n\t\t\t\t\tconsole.error('帖子加载失败', err);\n\t\t\t\t\tuni.showToast({ title: '帖子加载失败', icon: 'none' });\n\t\t\t\t});\n\t\t},\n\t\t// 辅助方法\n\t\tformatTime(ts) {\n\t\t\tconst date = new Date(ts);\n\t\t\t// 返回你想要的格式，比如\"1小时前\"或\"2024-06-03 15:00\"\n\t\t\treturn `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()} ${date.getHours()}:${date.getMinutes()}`;\n\t\t},\n\t\tgetTagClass(category) {\n\t\t\t// 根据分类返回不同的样式class\n\t\t\tif (category === '讨论') return 'discussion';\n\t\t\tif (category === '失物招领') return 'lost';\n\t\t\tif (category === '问答') return 'question';\n\t\t\t// 其他分类...\n\t\t\treturn '';\n\t\t},\n\t\t// 获取活动数据\n\t\tasync fetchActivitiesFromCloud() {\n\t\t\tthis.loading = true;\n\t\t\ttry {\n\t\t\t\t// 获取当前用户ID\n\t\t\t\tconst userId = uni.getStorageSync('uni-id-pages-userInfo')._id;\n\t\t\t\t\n\t\t\t\t// 获取所有活动\n\t\t\t\tconst res = await uniCloud.database().collection('add-content')\n\t\t\t\t\t.where({ content_type: 'activity', status: 'published' })\n\t\t\t\t\t.orderBy('create_time', 'desc')\n\t\t\t\t\t.get();\n\t\t\t\tconst activities = res.result.data;\n\t\t\t\t\n\t\t\t\t// 获取所有 user_id\n\t\t\t\tconst userIds = [...new Set(activities.map(item => item.user_id).filter(Boolean))];\n\t\t\t\tlet userMap = {};\n\t\t\t\tif (userIds.length) {\n\t\t\t\t\tconst userRes = await uniCloud.database().collection('uni-id-users')\n\t\t\t\t\t\t.where({ _id: uniCloud.database().command.in(userIds) })\n\t\t\t\t\t\t.field('_id,avatar_file,nickname')\n\t\t\t\t\t\t.get();\n\t\t\t\t\tuserRes.result.data.forEach(u => {\n\t\t\t\t\t\tuserMap[u._id] = u;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 获取用户参与状态\n\t\t\t\tlet userJoins = new Set();\n\t\t\t\tif (userId) {\n\t\t\t\t\tconst joinsRes = await uniCloud.database().collection('activity_participants')\n\t\t\t\t\t\t.where({\n\t\t\t\t\t\t\tuser_id: userId,\n\t\t\t\t\t\t\tactivity_id: uniCloud.database().command.in(activities.map(a => a._id))\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.get();\n\t\t\t\t\tuserJoins = new Set(joinsRes.result.data.map(j => j.activity_id));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 组装活动数据\n\t\t\t\tthis.activities = activities.map(item => {\n\t\t\t\t\tconst user = userMap[item.user_id] || {};\n\t\t\t\t\treturn {\n\t\t\t\t\t\t_id: item._id,\n\t\t\t\t\t\timage: item.files && item.files.length ? item.files[0] : '/static/images/activity-default.png',\n\t\t\t\t\t\ttag: item.category || '',\n\t\t\t\t\t\ttagClass: item.category === '官方' ? 'official' : (item.category === '热门' ? 'hot' : ''),\n\t\t\t\t\t\ttitle: item.title,\n\t\t\t\t\t\tdescription: item.content,\n\t\t\t\t\t\ttime: this.formatActivityTime(item.activity_time),\n\t\t\t\t\t\tlocation: item.location || '',\n\t\t\t\t\t\tavatars: user.avatar_file && user.avatar_file.url ? [user.avatar_file.url] : [],\n\t\t\t\t\t\tparticipants: item.attendee_count || 0,\n\t\t\t\t\t\thasJoined: userJoins.has(item._id) // 添加参与状态\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('获取活动数据失败', err);\n\t\t\t\tuni.showToast({ title: '获取活动数据失败', icon: 'none' });\n\t\t\t} finally {\n\t\t\t\tthis.loading = false;\n\t\t\t}\n\t\t},\n\t\t// 活动时间格式化\n\t\tformatActivityTime(ts) {\n\t\t\tif (!ts) return '';\n\t\t\tconst date = new Date(ts);\n\t\t\treturn `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}`;\n\t\t}\n\t}\n};\n</script>\n\n<style lang=\"scss\">\n@import '@/styles/variables.scss';\n@import '@/styles/common.scss';\n/* 导入微信小程序兼容样式 */\n@import '@/styles/platform-mp.scss';\n\n.circle-container {\n\tdisplay: flex;\n\tflex-direction: column;\n\tmin-height: 100vh;\n\tbackground-color: #F8F9FC; /* 更淡的背景色 */\n}\n\n.search-bar {\n\tpadding: 32rpx 24rpx 0 24rpx;\n\tbackground: #f8f9fc;\n}\n\n.search-input-wrapper {\n\tdisplay: flex;\n\talign-items: center;\n\tbackground: #f5f6fa;\n\tborder-radius: 32rpx;\n\tpadding: 0 24rpx;\n\theight: 64rpx;\n}\n\n.search-icon {\n\tfont-size: 32rpx;\n\tcolor: #b0b6be;\n\tmargin-right: 12rpx;\n}\n\n.search-input {\n\tflex: 1;\n\tborder: none;\n\tbackground: transparent;\n\tfont-size: 28rpx;\n\tcolor: #333;\n}\n\n.banner-wrapper {\n\tposition: relative;\n\twidth: 100%;\n\theight: 320rpx;\n}\n\n.banner-image {\n\twidth: 100%;\n\theight: 320rpx;\n\tobject-fit: cover;\n\tdisplay: block;\n}\n\n.banner-bottom-gradient {\n\tposition: absolute;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\theight: 120rpx;\n\tbackground: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,0.92) 100%);\n\tz-index: 1;\n\tpointer-events: none;\n}\n\n.category-nav-abs {\n\tposition: absolute;\n\tleft: 0;\n\tright: 0;\n\tbottom: -60rpx;\n\tz-index: 2;\n\tdisplay: flex;\n\tjustify-content: center;\n\tpadding: 0 24rpx;\n}\n\n.category-scroll {\n\twidth: 100%;\n\toverflow: visible;\n}\n\n.category-list {\n\tdisplay: flex;\n\talign-items: flex-end;\n}\n\n.category-container {\n\twidth: 28vw;\n\tmin-width: 28vw;\n\tdisplay: flex;\n\tjustify-content: center;\n}\n\n.category-item {\n\twidth: 92%;\n\tmargin: 0 auto;\n\tbackground: rgba(255,255,255,0.68);\n\tborder-radius: 32rpx;\n\tbox-shadow: 0 2rpx 10rpx rgba(77,124,191,0.06);\n\tborder: 1.5rpx solid rgba(77,124,191,0.08);\n\ttransition: all $transition-fast;\n\tpadding: 16rpx 0 8rpx 0;\n}\n\n.category-item.active {\n\tbackground: rgba($primary-color, 0.12);\n\tborder: 2rpx solid $primary-color;\n\tbox-shadow: 0 6rpx 24rpx rgba(77,124,191,0.13);\n\ttransform: scale(1.08);\n}\n\n.main-content {\n\tmargin-top: 56rpx;\n\tflex: 1;\n\t/* 这里放原有的内容区 */\n}\n\n.header {\n\tbackground-color: $white;\n\tposition: sticky;\n\ttop: 0;\n\tz-index: 100;\n\tbox-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.03);\n\tborder-bottom: 1rpx solid rgba(0, 0, 0, 0.02);\n}\n\n.header-left .iconfont {\n\tfont-size: $font-size-xl;\n\tcolor: $primary-color;\n}\n\n.header-left .title {\n\tfont-size: $font-size-lg;\n}\n\n.header-right .iconfont {\n\tfont-size: $font-size-lg;\n\tcolor: $gray;\n\tmargin-left: $spacing-lg;\n\ttransition: all $transition-fast;\n\t\n\t&:active {\n\t\tcolor: $primary-color;\n\t\ttransform: scale(1.05);\n\t}\n}\n\n.header-right .avatar {\n\twidth: 60rpx;\n\theight: 60rpx;\n\tmargin-left: $spacing-lg;\n\tborder: 2rpx solid $extra-light-gray;\n\tbox-shadow: 0 2rpx 6rpx rgba(0, 0, 0, 0.05);\n}\n\n.content-scroll {\n\tflex: 1;\n\theight: calc(100vh - 170rpx);\n\tpadding-bottom: 20rpx; \n}\n\n.section {\n\tposition: relative;\n\tborder-radius: $border-radius-base;\n\toverflow: hidden;\n\tbox-shadow: 0 2rpx 16rpx rgba(0, 0, 0, 0.04);\n\tborder: 1rpx solid rgba(0, 0, 0, 0.02);\n}\n\n/* 标题图标样式 */\n.icon-wrapper {\n\twidth: 64rpx;\n\theight: 64rpx;\n\tborder-radius: $border-radius-circle;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tmargin-right: $spacing-xs;\n\t\n\t&.bg-gradient-primary {\n\t\tbackground: linear-gradient(135deg, $primary-color, lighten($primary-color, 15%));\n\t}\n\t\n\t&.bg-gradient-warning {\n\t\tbackground: linear-gradient(135deg, $warning-color, lighten($warning-color, 15%));\n\t}\n\t\n\t&.bg-gradient-muted {\n\t\tbackground: linear-gradient(135deg, #7E8B9A, #A9B4C0);\n\t}\n\t\n\t.iconfont {\n\t\tfont-size: $font-size-lg;\n\t}\n}\n\n.section-title .iconfont {\n\tfont-size: $font-size-lg;\n}\n\n.more {\n\tposition: relative;\n\tpadding: $spacing-xs $spacing-sm;\n\tborder-radius: $border-radius-lg;\n\ttransition: all $transition-fast;\n\t\n\t&:active {\n\t\tbackground-color: $bg-color-hover;\n\t}\n}\n\n.badge {\n\tfont-size: $font-size-xs;\n\tbackground-color: $error-color;\n\tcolor: $white;\n\tborder-radius: $border-radius-circle;\n\twidth: 32rpx;\n\theight: 32rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n\n.filter-tabs {\n\tdisplay: flex;\n\tbackground-color: rgba(0, 0, 0, 0.03);\n\tborder-radius: $border-radius-lg;\n\tpadding: 4rpx;\n}\n\n.filter-tab {\n\tpadding: $spacing-xs $spacing-base;\n\tmargin-left: 0;\n\tborder-radius: $border-radius-lg;\n\tfont-size: $font-size-sm;\n\tcolor: $dark-gray;\n\ttransition: all $transition-fast;\n}\n\n.filter-tab.active {\n\tbackground-color: $primary-color;\n\tcolor: $white;\n\tbox-shadow: 0 2rpx 8rpx rgba(77, 124, 191, 0.25);\n}\n\n.filter-tab-active {\n\topacity: 0.8;\n}\n\n.activity-scroll {\n\twhite-space: nowrap;\n\tmargin: 0 -$spacing-xs;\n}\n\n.activity-list {\n\tdisplay: inline-flex;\n\tpadding: $spacing-xs $spacing-xs;\n}\n\n.fab-mask {\n\tposition: fixed;\n\tleft: 0; top: 0; right: 0; bottom: 0;\n\tbackground: rgba(0,0,0,0.18);\n\tz-index: 98;\n}\n\n.fab-menu {\n\tposition: fixed;\n\tright: 48rpx;\n\tbottom: 220rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: flex-end;\n\tz-index: 100;\n\tanimation: fab-fade-in 0.25s;\n}\n@keyframes fab-fade-in {\n\tfrom { opacity: 0; transform: translateY(30rpx);}\n\tto { opacity: 1; transform: translateY(0);}\n}\n.fab-menu-item {\n\tdisplay: flex;\n\talign-items: center;\n\tbackground: #fffbe8;\n\tborder-radius: 32rpx;\n\tbox-shadow: 0 2rpx 12rpx rgba(77,124,191,0.13);\n\tpadding: 18rpx 32rpx;\n\tmargin-bottom: 24rpx;\n\tfont-size: 30rpx;\n\tcolor: #333;\n\ttransition: all 0.2s;\n\t&:active {\n\t\tbackground: #ffe9a7;\n\t\ttransform: scale(0.97);\n\t}\n\t.iconfont {\n\t\tfont-size: 38rpx;\n\t\tmargin-right: 16rpx;\n\t\tcolor: #f7c948;\n\t}\n}\n.fab-menu-text {\n\tfont-weight: 600;\n\tfont-size: 28rpx;\n}\n.float-btn {\n\tposition: fixed;\n\tright: $spacing-lg;\n\tbottom: 100rpx;\n\twidth: 100rpx;\n\theight: 100rpx;\n\tborder-radius: $border-radius-circle;\n\tbackground: linear-gradient(135deg, $primary-color, lighten($primary-color, 10%));\n\tcolor: $white;\n\tbox-shadow: 0 4rpx 16rpx rgba(77, 124, 191, 0.3);\n\tz-index: 99;\n\ttransition: all $transition-base;\n}\n\n.float-btn .iconfont {\n\tfont-size: $font-size-xl;\n}\n\n.float-btn:active {\n\ttransform: scale(0.95);\n\tbox-shadow: 0 2rpx 8rpx rgba(77, 124, 191, 0.2);\n}\n\n/* 加载和空状态 */\n.loading {\n\tpadding: $spacing-lg 0;\n\ttext-align: center;\n\t\n\t.loading-icon {\n\t\tdisplay: inline-block;\n\t\tanimation: rotate 1s linear infinite;\n\t\tmargin-right: $spacing-xs;\n\t}\n}\n\n.empty-state {\n\tpadding: $spacing-xl 0;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\t\n\t.empty-icon {\n\t\tfont-size: 80rpx;\n\t\tcolor: $light-gray;\n\t\tmargin-bottom: $spacing-base;\n\t}\n\t\n\t.empty-text {\n\t\tcolor: $gray;\n\t\tfont-size: $font-size-base;\n\t\tmargin-bottom: $spacing-base;\n\t}\n}\n\n.text-muted {\n\tcolor: $gray;\n}\n\n.text-dark {\n\tcolor: $dark-gray;\n}\n\n@keyframes rotate {\n\tfrom {\n\t\ttransform: rotate(0deg);\n\t}\n\tto {\n\t\ttransform: rotate(360deg);\n\t}\n}\n\n.pinned-header {\n  align-items: center;\n  margin-bottom: 18rpx;\n}\n.pinned-gradient {\n  width: 56rpx;\n  height: 56rpx;\n  border-radius: 50%;\n  background: linear-gradient(135deg, #e7d7a7 0%, #f7e7b7 100%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 12rpx;\n  box-shadow: 0 2rpx 8rpx rgba(231, 215, 122, 0.18);\n}\n.pinned-title {\n  color: #000000;\n  font-size: 32rpx;\n  font-weight: 700;\n  margin-right: 8rpx;\n}\n.pinned-badge {\n  background: #e7d77a;\n  color: #4a4a4a;\n  border-radius: 16rpx;\n  font-size: 22rpx;\n  font-weight: 600;\n  padding: 0 14rpx;\n  min-width: 32rpx;\n  height: 32rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 4rpx;\n  box-shadow: 0 2rpx 8rpx rgba(231, 215, 122, 0.10);\n}\n</style>\n","import MiniProgramPage from 'D:/2大花/毕业设计/Compus/pages/circle/circle.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","res","uniCloud"],"mappings":"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"}