{"version":3,"file":"post-create.js","sources":["pages/circle/post-create/post-create.vue","../../../Software/hbuilder/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2lyY2xlL3Bvc3QtY3JlYXRlL3Bvc3QtY3JlYXRlLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"post-create-container\">\n\t\t<!-- 分类选择（美化，横向滚动，卡片风格） -->\n\t\t<view class=\"category-bar\">\n\t\t\t<view class=\"category-label\">选择分类</view>\n\t\t\t<scroll-view scroll-x class=\"category-scroll\">\n\t\t\t\t<view class=\"category-list\">\n\t\t\t\t\t<view\n\t\t\t\t\t\tv-for=\"(tag, idx) in tags\"\n\t\t\t\t\t\t:key=\"idx\"\n\t\t\t\t\t\tclass=\"category-item\"\n\t\t\t\t\t\t:class=\"{ active: selectedTag === tag }\"\n\t\t\t\t\t\t@tap=\"selectTag(tag)\"\n\t\t\t\t\t>{{ tag }}</view>\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t</view>\n\n\t\t<!-- 内容输入 -->\n\t\t<view class=\"content-section\">\n\t\t\t<textarea\n\t\t\t\tclass=\"content-input\"\n\t\t\t\tv-model=\"content\"\n\t\t\t\tmaxlength=\"1000\"\n\t\t\t\tplaceholder=\"写点什么和大家分享…\"\n\t\t\t\tauto-height\n\t\t\t\t@input=\"onInput\"\n\t\t\t/>\n\t\t\t<view class=\"input-count\">{{ content.length }}/1000</view>\n\t\t</view>\n\n\t\t<!-- 图片/视频添加（在内容输入框下方） -->\n\t\t<view class=\"media-section\">\n\t\t\t<view class=\"media-list\">\n\t\t\t\t<view\n\t\t\t\t\tv-for=\"(img, idx) in images\"\n\t\t\t\t\t:key=\"idx\"\n\t\t\t\t\tclass=\"media-item\"\n\t\t\t\t>\n\t\t\t\t\t<image :src=\"img\" mode=\"aspectFill\" class=\"media-img\"></image>\n\t\t\t\t\t<view class=\"media-remove\" @tap=\"removeImage(idx)\">×</view>\n\t\t\t\t</view>\n\t\t\t\t<view\n\t\t\t\t\tv-if=\"images.length < 9\"\n\t\t\t\t\tclass=\"media-add\"\n\t\t\t\t\t@tap=\"chooseImage\"\n\t\t\t\t>\n\t\t\t\t\t<view class=\"media-add-icon\">+</view>\n\t\t\t\t\t<view class=\"media-add-text\">照片/视频</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 发布按钮 -->\n\t\t<view class=\"footer\">\n\t\t\t<view\n\t\t\t\tclass=\"btn-publish\"\n\t\t\t\t:class=\"{ disabled: !canPublish }\"\n\t\t\t\t@tap=\"canPublish ? publishPost() : null\"\n\t\t\t>\n\t\t\t\t确定发布\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\ttags: ['讨论', '失物招领', '表白', '吐槽', '问答', '官方','商家'],\n\t\t\t\tselectedTag: '',\n\t\t\t\tcontent: '',\n\t\t\t\timages: []\n\t\t\t};\n\t\t},\n\t\tcomputed: {\n\t\t\tcanPublish() {\n\t\t\t\treturn  this.content.trim();\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tselectTag(tag) {\n\t\t\t\tthis.selectedTag = tag;\n\t\t\t},\n\t\t\tonInput(e) {\n\t\t\t\tthis.content = e.detail.value || this.content;\n\t\t\t},\n\t\t\tchooseImage() {\n\t\t\t\tuni.chooseImage({\n\t\t\t\t\tcount: 9 - this.images.length,\n\t\t\t\t\tsizeType: ['compressed'],\n\t\t\t\t\tsourceType: ['album', 'camera'],\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tthis.images = this.images.concat(res.tempFilePaths);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tremoveImage(idx) {\n\t\t\t\tthis.images.splice(idx, 1);\n\t\t\t},\n\t\t\tpublishPost() {\n\t\t\t\tif (!this.canPublish) return;\n\t\t\t\t\n\t\t\t\t// 显示加载提示\n\t\t\t\tuni.showLoading({\n\t\t\t\t\ttitle: '发布中...'\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// 上传图片\n\t\t\t\tconst uploadTasks = this.images.map(filePath => {\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tuniCloud.uploadFile({\n\t\t\t\t\t\t\tfilePath: filePath,\n\t\t\t\t\t\t\tcloudPath: `posts/${Date.now()}-${Math.random().toString(36).slice(-6)}.${filePath.split('.').pop()}`,\n\t\t\t\t\t\t\tsuccess: res => resolve(res.fileID),\n\t\t\t\t\t\t\tfail: err => reject(err)\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tPromise.all(uploadTasks)\n\t\t\t\t\t.then(fileIDs => {\n\t\t\t\t\t\t// 从本地存储获取用户id\n\t\t\t\t\t\tconst userInfo = uni.getStorageSync('uni-id-pages-userInfo')\n\t\t\t\t\t\tconst userId = userInfo && userInfo._id ? userInfo._id : ''\n\t\t\t\t\t\tif (!userId) {\n\t\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\t\tuni.showToast({ title: '请先登录', icon: 'none' });\n\t\t\t\t\t\t\treturn Promise.reject(new Error('请先登录'));\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn uniCloud.callFunction({\n\t\t\t\t\t\t\tname: 'add-content',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tcontent_type: 'post',\n\t\t\t\t\t\t\t\tcategory: this.selectedTag,\n\t\t\t\t\t\t\t\tcontent: this.content,\n\t\t\t\t\t\t\t\tuser_id: userId,\n\t\t\t\t\t\t\t\tfiles: fileIDs\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.then(res => {\n\t\t\t\t\t\tif (res && res.result && res.result.code === 200) {\n\t\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\t\tuni.showToast({ title: '发布成功', icon: 'success' });\n\t\t\t\t\t\t\tsetTimeout(() => { uni.navigateBack(); }, 800);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(res.result.msg);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\tif (err && err.message !== '请先登录') {\n\t\t\t\t\t\t\tuni.showToast({ title: err.message || '发布失败', icon: 'none' });\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n\t.post-create-container {\n\t\tmin-height: 100vh;\n\t\tbackground: #fff;\n\t\tpadding-bottom: 120rpx;\n\t}\n\t.category-bar {\n\t\tdisplay: flex;\n\t\talign-items: flex-start;\n\t\tpadding: 32rpx 24rpx 0 24rpx;\n\t\tbackground: #fff;\n\t\tpadding-bottom: 20rpx;\n\t}\n\t.category-label {\n\t\tfont-size: 28rpx;\n\t\tcolor: #333;\n\t\tfont-weight: 600;\n\t\tmargin-right: 12rpx;\n\t\tmargin-top: 8rpx;\n\t\tflex-shrink: 0;\n\t\tline-height: 1.6;\n\t}\n\t.category-scroll {\n\t\tflex: 1;\n\t\twhite-space: nowrap;\n\t}\n\t.category-list {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 18rpx;\n\t}\n\t.category-item {\n\t\tpadding: 12rpx 36rpx;\n\t\tbackground: #f5f6fa;\n\t\tborder-radius: 32rpx;\n\t\tcolor: #888;\n\t\tfont-size: 26rpx;\n\t\tmargin-right: 12rpx;\n\t\tborder: 2rpx solid transparent;\n\t\ttransition: all 0.2s;\n\t\tfont-weight: 500;\n\t\tbox-shadow: 0 2rpx 8rpx rgba(247,201,72,0.04);\n\t}\n\t.category-item.active {\n\t\tbackground: linear-gradient(90deg, #f7c948 0%, #f7e7b7 100%);\n\t\tcolor: #c09853;\n\t\tborder-color: #f7c948;\n\t\tfont-weight: 700;\n\t\tbox-shadow: 0 4rpx 16rpx rgba(247,201,72,0.10);\n\t}\n\t.content-section {\n\t\tbackground:#fff;\n\t\tmargin: 0 0 0 0;\n\t\tpadding: 24rpx 24rpx 0 24rpx;\n\t}\n\t.content-input {\n\t\twidth: 100%;\n\t\tmin-height: 300rpx;\n\t\tbackground: #fff;\n\n\t\tfont-size: 28rpx;\n\t\tcolor: #333;\n\t\tborder: none;\n\t\tmargin-bottom: 8rpx;\n\t}\n\t.input-count {\n\t\ttext-align: right;\n\t\tcolor: #caced3;\n\t\tfont-size: 22rpx;\n\t\tmargin-bottom: 12rpx;\n\t}\n\t.media-section {\n\t\tbackground:#fff;\n\t\t// margin: 0 0 0 0;\n\t\t\n\t\tpadding: 0 24rpx 0 24rpx;\n\t\tpadding-top: 30rpx;\n\t\tpadding-bottom: 30rpx;\n\t}\n\t.media-list {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tgap: 18rpx;\n\t\tmargin-bottom: 12rpx;\n\t}\n\t.media-item {\n\t\tposition: relative;\n\t}\n\t.media-img {\n\t\twidth: 160rpx;\n\t\theight: 160rpx;\n\t\tborder-radius: 16rpx;\n\t\tobject-fit: cover;\n\t\tbackground: #f5f6fa;\n\t}\n\t.media-remove {\n\t\tposition: absolute;\n\t\ttop: -12rpx;\n\t\tright: -12rpx;\n\t\tbackground: #f56c6c;\n\t\tcolor: #fff;\n\t\tborder-radius: 50%;\n\t\twidth: 32rpx;\n\t\theight: 32rpx;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tfont-size: 24rpx;\n\t\tz-index: 2;\n\t\tbox-shadow: 0 2rpx 8rpx rgba(0,0,0,0.10);\n\t}\n\t.media-add {\n\t\twidth: 160rpx;\n\t\theight: 160rpx;\n\t\tborder-radius: 16rpx;\n\t\tbackground: #f5f6fa;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tcolor: #e0c97b;\n\t\tborder: 2rpx dashed #f7e7b7;\n\t\tcursor: pointer;\n\t}\n\t.media-add-icon {\n\t\tfont-size: 60rpx;\n\t\tcolor: #e0c97b;\n\t\tline-height: 1;\n\t}\n\t.media-add-text {\n\t\tfont-size: 24rpx;\n\t\tcolor: #b0b6be;\n\t\tmargin-top: 8rpx;\n\t}\n\t.footer {\n\t\tposition: fixed;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tbackground: #fff;\n\t\tpadding: 18rpx 32rpx 24rpx 32rpx;\n\t\tz-index: 10;\n\t}\n\t.btn-publish {\n\t\twidth: 92%;\n\t\tmargin: 0 auto;\n\t\theight: 88rpx;\n\t\tbackground: linear-gradient(90deg, #ffe37c 0%, #f7c948 100%);\n\t\tcolor: #333;\n\t\tfont-size: 32rpx;\n\t\tfont-weight: 700;\n\t\tborder-radius: 20rpx;\n\t\tletter-spacing: 2rpx;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\topacity: 1;\n\t\ttransition: background 0.2s, opacity 0.2s;\n\t}\n\t.btn-publish.disabled {\n\t\tbackground: #b2b2b4 !important;\n\t\tcolor: #dadde3 !important;\n\t\topacity: 0.7;\n\t\tpointer-events: none;\n\t}\n</style>\n","import MiniProgramPage from 'D:/2大花/毕业设计/Compus/pages/circle/post-create/post-create.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":"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"}