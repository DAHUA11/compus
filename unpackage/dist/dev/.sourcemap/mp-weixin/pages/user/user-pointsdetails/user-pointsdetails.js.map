{"version":3,"file":"user-pointsdetails.js","sources":["pages/user/user-pointsdetails/user-pointsdetails.vue","../../../Software/hbuilder/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci91c2VyLXBvaW50c2RldGFpbHMvdXNlci1wb2ludHNkZXRhaWxzLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"score-detail-page\">\n\t\t<view class=\"score-summary\">\n\t\t\t<text class=\"score-label\">当前积分</text>\n\t\t\t<text class=\"score-value\">{{ totalScore }}</text>\n\t\t\t<button class=\"exchange-btn\" @click=\"goToExchange\">积分兑换</button>\n\t\t</view>\n\t\t<view class=\"tab-bar\">\n\t\t\t<view\n\t\t\t\tv-for=\"tab in tabs\"\n\t\t\t\t:key=\"tab.type\"\n\t\t\t\t:class=\"['tab-item', {active: currentType === tab.type}]\"\n\t\t\t\t@click=\"switchTab(tab.type)\"\n\t\t\t>\n\t\t\t\t{{ tab.text }}\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"score-list\">\n\t\t\t<view v-for=\"item in filteredList\" :key=\"item.id\" class=\"score-item\">\n\t\t\t\t<uni-icons :type=\"item.icon\" size=\"20\" :color=\"item.amount > 0 ? '#4CAF50' : '#FF5252'\" />\n\t\t\t\t<view class=\"score-info\">\n\t\t\t\t\t<text class=\"score-desc\">{{ item.desc }}</text>\n\t\t\t\t\t<text class=\"score-time\">{{ item.time }}</text>\n\t\t\t\t</view>\n\t\t\t\t<text :class=\"['score-amount', item.amount > 0 ? 'plus' : 'minus']\">\n\t\t\t\t\t{{ item.amount > 0 ? '+' : '' }}{{ item.amount }}\n\t\t\t\t</text>\n\t\t\t</view>\n\t\t\t<view v-if=\"filteredList.length === 0\" class=\"empty-tip\">暂无明细</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\ttotalScore: 0,\n\t\t\t\ttabs: [\n\t\t\t\t\t{ text: '获取明细', type: 'gain' },\n\t\t\t\t\t{ text: '扣除明细', type: 'cost' }\n\t\t\t\t],\n\t\t\t\tcurrentType: 'gain',\n\t\t\t\tscoreList: []\n\t\t\t};\n\t\t},\n\t\tcomputed: {\n\t\t\tfilteredList() {\n\t\t\t\treturn this.scoreList.filter(item => item.type === this.currentType)\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\t// 获取积分记录\n\t\t\tasync getScoreRecords() {\n\t\t\t\ttry {\n\t\t\t\t\tconst userInfo = uni.getStorageSync('uni-id-pages-userInfo')\n\t\t\t\t\tif (!userInfo || !userInfo._id) {\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '请先登录',\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t})\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconst db = uniCloud.database()\n\t\t\t\t\tconst { result } = await db.collection('user-score')\n\t\t\t\t\t\t.where({\n\t\t\t\t\t\t\tuser_id: userInfo._id\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.orderBy('create_time', 'desc')\n\t\t\t\t\t\t.get()\n\t\t\t\t\t\n\t\t\t\t\tif (result && result.data) {\n\t\t\t\t\t\t// 处理积分记录\n\t\t\t\t\t\tthis.scoreList = result.data.map(record => {\n\t\t\t\t\t\t\tconst isGain = record.score > 0\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tid: record._id,\n\t\t\t\t\t\t\t\ttype: isGain ? 'gain' : 'cost',\n\t\t\t\t\t\t\t\ticon: this.getIconByType(record.type),\n\t\t\t\t\t\t\t\tdesc: record.description || this.getDescriptionByType(record.type),\n\t\t\t\t\t\t\t\ttime: this.formatTime(record.create_time),\n\t\t\t\t\t\t\t\tamount: record.score\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 计算总积分\n\t\t\t\t\t\tthis.totalScore = this.scoreList.reduce((sum, record) => sum + record.amount, 0)\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('获取积分记录失败：', error)\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '获取积分记录失败',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t// 根据类型获取图标\n\t\t\tgetIconByType(type) {\n\t\t\t\tconst iconMap = {\n\t\t\t\t\t'post_pin': 'pushpin',\n\t\t\t\t\t'post_like': 'heart',\n\t\t\t\t\t'comment_like': 'chat',\n\t\t\t\t\t'daily_sign': 'calendar',\n\t\t\t\t\t'task-review': 'star',\n\t\t\t\t\t'activity_create': 'plus',\n\t\t\t\t\t'activity_join': 'person',\n\t\t\t\t\t'task-finished': 'checkmark'\n\t\t\t\t}\n\t\t\t\treturn iconMap[type] || 'info'\n\t\t\t},\n\t\t\t\n\t\t\t// 根据类型获取描述\n\t\t\tgetDescriptionByType(type) {\n\t\t\t\tconst descMap = {\n\t\t\t\t\t'post_pin': '帖子置顶',\n\t\t\t\t\t'post_like': '帖子获赞',\n\t\t\t\t\t'comment_like': '评论获赞',\n\t\t\t\t\t'daily_sign': '每日签到',\n\t\t\t\t\t'task-review': '任务评价',\n\t\t\t\t\t'activity_create': '创建活动',\n\t\t\t\t\t'activity_join': '参与活动',\n\t\t\t\t\t'task-finished': '完成任务'\n\t\t\t\t}\n\t\t\t\treturn descMap[type] || '积分变动'\n\t\t\t},\n\t\t\t\n\t\t\t// 格式化时间\n\t\t\tformatTime(timestamp) {\n\t\t\t\tconst date = new Date(timestamp)\n\t\t\t\tconst year = date.getFullYear()\n\t\t\t\tconst month = String(date.getMonth() + 1).padStart(2, '0')\n\t\t\t\tconst day = String(date.getDate()).padStart(2, '0')\n\t\t\t\tconst hour = String(date.getHours()).padStart(2, '0')\n\t\t\t\tconst minute = String(date.getMinutes()).padStart(2, '0')\n\t\t\t\treturn `${year}-${month}-${day} ${hour}:${minute}`\n\t\t\t},\n\t\t\t\n\t\t\tswitchTab(type) {\n\t\t\t\tthis.currentType = type\n\t\t\t},\n\t\t\t\n\t\t\tgoToExchange() {\n\t\t\t\tuni.showToast({ title: '跳转到兑换页面', icon: 'none' })\n\t\t\t\t// uni.navigateTo({ url: '/pages/user/score-exchange/score-exchange' })\n\t\t\t}\n\t\t},\n\t\t\n\t\tonLoad() {\n\t\t\tthis.getScoreRecords()\n\t\t},\n\t\t\n\t\tonShow() {\n\t\t\tthis.getScoreRecords()\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\">\n\t.score-detail-page {\n\t\tbackground: #f5f6fa;\n\t\tmin-height: 100vh;\n\t\tpadding-bottom: 40rpx;\n\t}\n\t.score-summary {\n\t\tbackground: #fff;\n\t\tborder-radius: 18rpx;\n\t\tbox-shadow: 0 4px 16px rgba(64,128,255,0.10);\n\t\tmargin: 32rpx 24rpx 0 24rpx;\n\t\tpadding: 32rpx 24rpx 24rpx 24rpx;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t\tposition: relative;\n\t}\n\t.score-label {\n\t\tfont-size: 15px;\n\t\tcolor: #888;\n\t}\n\t.score-value {\n\t\tfont-size: 32px;\n\t\tfont-weight: 700;\n\t\tcolor: #4080FF;\n\t\tmargin: 0 16rpx;\n\t}\n\t.exchange-btn {\n\t\tfont-size: 14px;\n\t\tcolor: #fff;\n\t\tbackground: linear-gradient(90deg, #4080FF, #60A9FF);\n\t\tborder-radius: 24rpx;\n\t\tpadding: 10rpx 28rpx;\n\t\tborder: none;\n\t}\n\t.tab-bar {\n\t\tdisplay: flex;\n\t\tbackground: #fff;\n\t\tborder-radius: 16rpx;\n\t\tmargin: 32rpx 24rpx 0 24rpx;\n\t\tbox-shadow: 0 2px 8px rgba(0,0,0,0.04);\n\t\toverflow: hidden;\n\t}\n\t.tab-item {\n\t\tflex: 1;\n\t\ttext-align: center;\n\t\tpadding: 28rpx 0;\n\t\tfont-size: 17px;\n\t\tcolor: #888;\n\t\tcursor: pointer;\n\t\ttransition: color 0.2s;\n\t\tletter-spacing: 1px;\n\t}\n\t.tab-item.active {\n\t\tcolor: #4080FF;\n\t\tfont-weight: 700;\n\t\tbackground: linear-gradient(to right, #eaf2ff, #f5faff);\n\t\tbox-shadow: 0 2px 8px rgba(64,128,255,0.06);\n\t}\n\t.score-list {\n\t\tmargin: 36rpx 24rpx 0 24rpx;\n\t}\n\t.score-item {\n\t\tbackground: #fff;\n\t\tborder-radius: 16rpx;\n\t\tbox-shadow: 0 2px 8px rgba(64,128,255,0.08);\n\t\tpadding: 22rpx 20rpx 18rpx 20rpx;\n\t\tmargin-bottom: 18rpx;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t}\n\t.score-info {\n\t\tflex: 1;\n\t\tmargin-left: 16rpx;\n\t}\n\t.score-desc {\n\t\tfont-size: 15px;\n\t\tcolor: #222;\n\t\tfont-weight: 600;\n\t}\n\t.score-time {\n\t\tfont-size: 12px;\n\t\tcolor: #aaa;\n\t\tmargin-top: 4rpx;\n\t\tdisplay: block;\n\t}\n\t.score-amount {\n\t\tfont-size: 18px;\n\t\tfont-weight: 700;\n\t\tmin-width: 60rpx;\n\t\ttext-align: right;\n\t}\n\t.score-amount.plus {\n\t\tcolor: #4CAF50;\n\t}\n\t.score-amount.minus {\n\t\tcolor: #FF5252;\n\t}\n\t.empty-tip {\n\t\ttext-align: center;\n\t\tcolor: #bbb;\n\t\tmargin-top: 80rpx;\n\t\tfont-size: 17px;\n\t\tletter-spacing: 1px;\n\t}\n</style>\n","import MiniProgramPage from 'D:/2大花/毕业设计/Compus/pages/user/user-pointsdetails/user-pointsdetails.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":"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"}